schema: '2.0'
stages:
  load_data:
    cmd: PYTHONPATH="." python project/load_data/load_data.py --config-path params.yaml
    deps:
    - path: project/load_data/load_data.py
      md5: 474695a412bc3bb5de28cd968d130b8f
      size: 990
    outs:
    - path: data/load_raw
      md5: 367fd690a76a537d38ddd21dce065eab.dir
      size: 3739
      nfiles: 2
  prepair_target:
    cmd: PYTHONPATH="." python project/prepair_target/prepair_target.py --config-path
      params.yaml
    deps:
    - path: data/load_raw
      md5: 367fd690a76a537d38ddd21dce065eab.dir
      size: 3739
      nfiles: 2
    - path: project/prepair_target/prepair_target.py
      md5: 6fa849da757793bee5525d7545d988fc
      size: 1083
    params:
      params.yaml:
        prepare_target:
          target_group: all
    outs:
    - path: data/prepare_targets
      md5: 37f78105e8f39f6eff7650185e52ce4d.dir
      size: 803
      nfiles: 1
  prepair_features:
    cmd: PYTHONPATH="." python project/prepair_features/prepair_features.py --config-path
      params.yaml
    deps:
    - path: data/load_raw
      md5: 367fd690a76a537d38ddd21dce065eab.dir
      size: 3739
      nfiles: 2
    - path: project/prepair_features/prepair_features.py
      md5: e27541db5771953df00bcc5e7d9ea7ac
      size: 1157
    params:
      params.yaml:
        prepare_features:
          features_group: sepal_group
    outs:
    - path: data/prepare_features
      md5: 6d0ea74bf0556c681c43770e6000bb5b.dir
      size: 1716
      nfiles: 1
  merge:
    cmd: PYTHONPATH="." python project/merge/merge.py --config-path params.yaml
    deps:
    - path: data/prepare_features
      md5: 6d0ea74bf0556c681c43770e6000bb5b.dir
      size: 1716
      nfiles: 1
    - path: data/prepare_targets
      md5: 37f78105e8f39f6eff7650185e52ce4d.dir
      size: 803
      nfiles: 1
    - path: project/merge/merge.py
      md5: 1b8765552b8962ad7509af895dd0bf54
      size: 979
    params:
      params.yaml:
        joined:
          how: inner
    outs:
    - path: data/joined
      md5: d41b65d4e2c312a326624110b4fdeb00.dir
      size: 1527
      nfiles: 1
  prepair_dataset:
    cmd: PYTHONPATH="." python project/prepair_dataset/prepair_dataset.py --config-path
      params.yaml
    deps:
    - path: data/joined
      md5: d41b65d4e2c312a326624110b4fdeb00.dir
      size: 1527
      nfiles: 1
    - path: project/prepair_dataset/prepair_dataset.py
      md5: c3f82507dd5c2aa51fd234ecd7606c04
      size: 1008
    params:
      params.yaml:
        prepare_dataset:
          ratio: 0.1
    outs:
    - path: data/prepare_dataset
      md5: c9ead1b881e7c16a38f1f6df3a33bf67.dir
      size: 1554
      nfiles: 2
  train_models:
    cmd: PYTHONPATH="." python project/train_model/train_model.py --config-path params.yaml
    deps:
    - path: data/prepare_dataset
      md5: c9ead1b881e7c16a38f1f6df3a33bf67.dir
      size: 1554
      nfiles: 2
    - path: project/train_model/train_model.py
      md5: 509bd70f854a5bcc6bbde84f270ad172
      size: 1242
    params:
      params.yaml:
        train_model:
          model_name: decision_tree
          metrics:
          - precision
          - recall
          - accuracy
    outs:
    - path: data/metrics/train_metrics.json
      md5: ccace45fe29a1231b3ca9c6bb61b903c
      size: 109
    - path: data/train_model
      md5: ccc178ce6a5f0b0d800207cd23a61950.dir
      size: 7979
      nfiles: 1
  eval_model:
    cmd: PYTHONPATH="." python project/eval_model/eval_model.py --config-path params.yaml
    deps:
    - path: data/train_model
      md5: ccc178ce6a5f0b0d800207cd23a61950.dir
      size: 7979
      nfiles: 1
    - path: project/eval_model/eval_model.py
      md5: 146be0536509f80fe97ce7fbc4044748
      size: 1102
    params:
      params.yaml:
        eval_model:
          model_name: decision_tree
          metrics:
          - precision
          - recall
          - accuracy
    outs:
    - path: data/metrics/test_metrics.json
      md5: 0ecb756853857d1062b5721e810fd719
      size: 65
  mlflow_log:
    cmd: PYTHONPATH="." python project/mlflow_log/mlflow_log.py --config-path params.yaml
    deps:
    - path: data/metrics/test_metrics.json
      md5: 0ecb756853857d1062b5721e810fd719
      size: 65
    - path: project/mlflow_log/mlflow_log.py
      md5: 9dab9fd4aac2ddaebabeb8389e0f8b37
      size: 1116
    params:
      params.yaml:
        mlflow_log:
          experiment_name: test1
          run_name: test_run_name
  eval:
    cmd: PYTHONPATH="." python lib/eval.py --config-path params.yaml
    deps:
    - path: data/data.json
      md5: a9c979175425be3bb7a055f17aa7afbc
      size: 3800
    - path: data/model.pkl
      md5: 669d312dfab916a55bbdc832ca777e2a
      size: 347
    - path: data/train
      md5: 04eab86ea7c33117dd8fc41fab94d9be.dir
      size: 12648
      nfiles: 3
    - path: lib/data_preprocess.py
      md5: 9314fe7ca25e2b03bd2038fa9e846027
      size: 365
    - path: lib/eval.py
      md5: 2d25e6a470804a4b945c2fd341db3d92
      size: 552
    - path: lib/helper_funcs.py
      md5: 4b5f2eea1fbaa7d5089c94ea039ca64e
      size: 2155
    - path: lib/settings.py
      md5: e52a489acf099e1669bb54a1ead8a1bf
      size: 1834
    params:
      params.yaml:
        eval:
        metrics:
        - sklearn.metrics.precision_score:
            average: macro
        - sklearn.metrics.recall_score:
            average: macro
        - sklearn.metrics.accuracy_score
    outs:
    - path: data/eval
      md5: cc2f31509da5c51fa904f45b211bd41a.dir
      size: 10739
      nfiles: 1
    - path: data/metrics.json
      md5: 45c2b3bd5712d31deedeafc5d2977fbe
      size: 113
  data_preprocess:
    cmd:
    - PYTHONPATH="." python lib/data_preprocess.py --config-path params.yaml
    deps:
    - path: lib/data_preprocess.py
      md5: 9314fe7ca25e2b03bd2038fa9e846027
      size: 365
    - path: lib/helper_funcs.py
      md5: 4b5f2eea1fbaa7d5089c94ea039ca64e
      size: 2155
    - path: lib/settings.py
      md5: e52a489acf099e1669bb54a1ead8a1bf
      size: 1834
    params:
      params.yaml:
        train:
          test_size: 0.2
          features:
          - sepal length (cm)
          - sepal width (cm)
          - petal length (cm)
          - petal width (cm)
          model:
            model_class: sklearn.tree.DecisionTreeClassifier
            params:
              min_samples_split: 2
    outs:
    - path: data/data.json
      md5: a9c979175425be3bb7a055f17aa7afbc
      size: 3800
    - path: data/model.pkl
      md5: 669d312dfab916a55bbdc832ca777e2a
      size: 347
  train:
    cmd:
    - PYTHONPATH="." python lib/train.py --config-path params.yaml
    deps:
    - path: data/data.json
      md5: a9c979175425be3bb7a055f17aa7afbc
      size: 3800
    - path: data/model.pkl
      md5: 669d312dfab916a55bbdc832ca777e2a
      size: 347
    - path: lib/data_preprocess.py
      md5: 9314fe7ca25e2b03bd2038fa9e846027
      size: 365
    - path: lib/helper_funcs.py
      md5: 4b5f2eea1fbaa7d5089c94ea039ca64e
      size: 2155
    - path: lib/settings.py
      md5: e52a489acf099e1669bb54a1ead8a1bf
      size: 1834
    - path: lib/train.py
      md5: 03aa82274eb88096fcb2041724b859ed
      size: 740
    params:
      params.yaml:
        metrics:
        - sklearn.metrics.precision_score:
            average: macro
        - sklearn.metrics.recall_score:
            average: macro
        - sklearn.metrics.accuracy_score
        train:
          test_size: 0.2
          features:
          - sepal length (cm)
          - sepal width (cm)
          - petal length (cm)
          - petal width (cm)
          model:
            model_class: sklearn.tree.DecisionTreeClassifier
            params:
              min_samples_split: 2
    outs:
    - path: data/train
      md5: 04eab86ea7c33117dd8fc41fab94d9be.dir
      size: 12648
      nfiles: 3
